<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeMatch | Get Quotes for Your Project</title>
    <meta name="description" content="Get free quotes from verified tradespeople for your home improvement project. Post your job and receive multiple competitive quotes.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Outfit:wght@600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF385C;
            --primary-dark: #D50027;
            --secondary: #00B4D8;
            --dark: #1A1A1A;
            --gray: #717171;
            --light: #F7F7F7;
            --white: #FFFFFF;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            color: var(--dark);
            line-height: 1.6;
            background: #F9F9F9;
        }
        
        /* Navigation */
        nav {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-family: 'Outfit', sans-serif;
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, #FF6B6B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #FFF5F7 0%, #F0F9FF 100%);
            padding: 80px 20px;
            text-align: center;
        }
        
        .hero h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero p {
            font-size: 18px;
            color: var(--gray);
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Quote Form */
        .quote-form-container {
            max-width: 800px;
            margin: -40px auto 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            padding: 40px;
        }
        
        .form-progress {
            margin-bottom: 40px;
            position: relative;
        }
        
        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #E8E8E8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .step-circle.active {
            background: var(--primary);
            color: white;
        }
        
        .step-circle.completed {
            background: #D4EDDA;
            color: #155724;
        }
        
        .step-line {
            width: 60px;
            height: 2px;
            background: #E8E8E8;
        }
        
        .step-line.completed {
            background: #D4EDDA;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h3 {
            font-family: 'Outfit', sans-serif;
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--neu-light);
            text-shadow: 1px 1px 2px var(--neu-shadow-2);
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #E8E8E8;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'DM Sans', sans-serif;
            transition: all 0.2s;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255, 56, 92, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .service-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .service-card {
            padding: 20px;
            border: 2px solid transparent;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .service-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 70%, transparent 70%);
            border-radius: 12px;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .service-card:hover {
            transform: translateY(-8px) scale(1.02);
            border: 1px solid var(--primary);
        }
        
        .service-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }
        
        .service-card:hover::before {
            opacity: 1;
        }
        
        .service-icon {
            font-size: 40px;
            margin-bottom: 15px;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            transition: transform 0.3s;
        }
        
        .service-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            border-color: var(--primary);
        }
        
        .service-card.selected {
            border-color: var(--primary);
            background: rgba(255, 56, 92, 0.05);
        }
        
        .service-icon {
            font-size: 40px;
            margin-bottom: 15px;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }
        
        .service-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
            position: relative;
            z-index: 1;
        }
        
        .service-desc {
            font-size: 14px;
            color: var(--neu-shadow-2);
            margin-top: 5px;
            line-height: 1.4;
            opacity: 0.9;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, #FF6B6B 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 56, 92, 0.3);
        }
        
        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }
        
        .btn-full {
            width: 100%;
            justify-content: center;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Success Modal */
        .success-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        .success-modal.active {
            display: flex;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        .success-content {
            padding: 40px;
            text-align: center;
            animation: slideInUp 0.5s ease-out;
        }
        
        .success-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .success-title {
            font-family: 'Outfit', sans-serif;
            font-size: 28px;
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .success-message {
            color: var(--gray);
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .success-actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn-outline {
            background: var(--neu-light);
            color: var(--neu-dark);
            padding: 12px 20px;
            border-radius: 8px;
            border: 2px solid var(--border);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--neu-shadow-1);
        }
        
        .btn-full {
            background: var(--gradient-1);
            color: white;
            padding: 16px 32px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--neu-shadow-2);
        }
        
        .quote-id {
            font-family: 'Courier New', monospace;
            background: var(--dark);
            color: var(--primary-light);
            padding: 10px 15px;
            border-radius: 6px;
            display: inline-block;
            margin-top: 10px;
            font-size: 14px;
            letter-spacing: 1px;
        }
        
        /* Budget Slider Styles */
        .budget-slider-container {
            margin: 20px 0;
        }

        .budget-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .budget-separator {
            font-size: 14px;
            color: var(--gray);
            font-weight: 400;
        }

        .dual-range-slider {
            position: relative;
            height: 6px;
            background: linear-gradient(90deg, #E0E0E0 0%, var(--primary) 100%);
            border-radius: 3px;
            margin: 30px 10px;
        }

        .dual-range-slider input[type="range"] {
            position: absolute;
            width: 100%;
            height: 6px;
            top: -2px;
            background: transparent;
            pointer-events: none;
            -webkit-appearance: none;
        }

        .dual-range-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            pointer-events: auto;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(255, 56, 92, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .dual-range-slider input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(255, 56, 92, 0.5);
        }

        .dual-range-slider input[type="range"]::-moz-range-thumb {
            pointer-events: auto;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(255, 56, 92, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .dual-range-slider input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(255, 56, 92, 0.5);
        }

        .budget-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray);
            margin-top: 10px;
        }

        /* Postcode Validation */
        .postcode-suggestions {
            position: absolute;
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 5px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
        }

        .postcode-suggestion {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #F0F0F0;
        }

        .postcode-suggestion:last-child {
            border-bottom: none;
        }

        .postcode-suggestion:hover {
            background: #F7F7F7;
            color: var(--primary);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 32px;
            }
            
            .quote-form-container {
                padding: 30px 20px;
                margin: -20px 20px 40px;
            }
            
            .service-cards {
                grid-template-columns: 1fr;
            }
            
            .nav-container {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">TradeMatch</a>
            <div class="auth-buttons" id="authButtons">
                <button class="btn btn-secondary" onclick="openAuthModal('login')">Login</button>
                <button class="btn" onclick="openAuthModal('register')">Sign Up</button>
            </div>
        </div>
    </nav>
    
    <!-- Hero Section -->
    <section class="hero">
        <h1>Get Quotes for Your Project</h1>
        <p>Tell us what you need and receive competitive quotes from verified tradespeople in your area.</p>
    </section>
    
    <!-- Quote Form -->
    <div class="quote-form-container">
        <!-- Progress Steps -->
<div class="form-progress">
            <div class="progress-step">
                <div class="step-circle" id="step1">1</div>
                <div class="step-line" id="line1"></div>
            </div>
            <div class="progress-step">
                <div class="step-circle" id="step2">2</div>
                <div class="step-line" id="line2"></div>
            </div>
            <div class="progress-step">
                <div class="step-circle" id="step3">3</div>
            </div>
        </div>
        
        <!-- Step 2: Budget Range -->
        <div class="form-section" id="serviceSection">
            <h3>What service do you need?</h3>
            <div class="service-cards">
                <div class="service-card" onclick="selectService('extension', 'üèóÔ∏è', 'Extensions')" data-service="extension">
                    <div class="service-icon">üèóÔ∏è</div>
                    <div class="service-name">House Extension</div>
                    <div class="service-desc">Single & double storey</div>
                </div>
                <div class="service-card" onclick="selectService('loft')" data-service="loft">
                    <div class="service-icon">üè†</div>
                    <div class="service-name">Loft Conversion</div>
                    <div class="service-desc">Transform your attic</div>
                </div>
                <div class="service-card" onclick="selectService('kitchen')">
                    <div class="service-icon">üç≥</div>
                    <div class="service-name">Kitchen Fitting</div>
                    <div class="service-desc">Complete installation</div>
                </div>
                <div class="service-card" onclick="selectService('bathroom')">
                    <div class="service-icon">üöø</div>
                    <div class="service-name">Bathroom</div>
                    <div class="service-desc">Installation & renovation</div>
                </div>
                <div class="service-card" onclick="selectService('roofing')" data-service="roofing">
                    <div class="service-icon">üèöÔ∏è</div>
                    <div class="service-name">Roofing</div>
                    <div class="service-desc">Repairs & replacement</div>
                </div>
                <div class="service-card" onclick="selectService('electrical')" data-service="electrical">
                    <div class="service-icon">‚ö°</div>
                    <div class="service-name">Electrical</div>
                    <div class="service-desc">Certified electricians</div>
                </div>
                <div class="service-card" onclick="selectService('plumbing')" data-service="plumbing">
                    <div class="service-icon">üîß</div>
                    <div class="service-name">Plumbing</div>
                    <div class="service-desc">Boilers & heating</div>
                </div>
                <div class="service-card" onclick="selectService('flooring')" data-service="flooring">
                    <div class="service-icon">üè†</div>
                    <div class="service-name">Flooring</div>
                    <div class="service-desc">Hardwood & laminate</div>
                </div>
                <div class="service-card" onclick="selectService('painting')" data-service="painting">
                    <div class="service-icon">üé®</div>
                    <div class="service-name">Painting & Decorating</div>
                    <div class="service-desc">Interior & exterior</div>
                </div>
            </div>
        </div>
        
<!-- Step 2: Budget Range -->
        <div class="form-section" id="detailsSection" style="display: none;">
            <h3>Tell us more about your project</h3>
            <div class="form-group">
                <label class="form-label">Your Postcode</label>
                <div style="display: flex; gap: 10px;">
                    <input 
                        type="text" 
                        class="form-input" 
                        id="postcode" 
                        placeholder="e.g., SW1A 1AA" 
                        oninput="validatePostcode(this)"
                        required
                        style="flex: 1;"
                    />
                    <button type="button" class="btn btn-outline" onclick="getCurrentLocation()" style="padding: 12px 20px; font-size: 14px;">
                        üìç Get Location
                    </button>
                </div>
                <div id="postcodeValidation" class="validation-message"></div>
                <div id="postcodesuggestions" class="postcode-suggestions"></div>
            </div>
            <div class="form-group">
                <label class="form-label">Project Title</label>
                <input type="text" class="form-input" id="title" placeholder="Brief description of your project">
            </div>
            <div class="form-group">
                <label class="form-label">Project Description</label>
                <textarea class="form-textarea" id="description" placeholder="Provide more details about what you need done..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">When do you need this done?</label>
                <select class="form-select" id="urgency">
                    <option value="asap">ASAP (Within 1 month)</option>
                    <option value="1-3months">1-3 months</option>
                    <option value="3-6months">3-6 months</option>
                    <option value="planning">Just planning</option>
                </select>
            </div>
            
            <!-- Contact Information (optional for vendor registration) -->
            <div class="form-group">
                <label class="form-label">Phone Number (Optional)</label>
                <input type="tel" class="form-input" id="phone" placeholder="07xxx xxx xxx">
            </div>
            <div class="form-group">
                <label class="form-label">Company Name (Optional)</label>
                <input type="text" class="form-input" id="company" placeholder="Your company name">
            </div>
            <div class="form-group">
                <label class="form-label">Website (Optional)</label>
                <input type="url" class="form-input" id="website" placeholder="https://yourwebsite.com">
            </div>
            
            <!-- Professional Information (optional for vendor registration) -->
            <div class="form-group">
                <label class="form-label">Trade Category (Optional)</label>
                <select class="form-select" id="tradeCategory">
                    <option value="">Select your trade (for tradespeople)</option>
                    <option value="builder">Builder/Extension Specialist</option>
                    <option value="plumber">Plumber</option>
                    <option value="electrician">Electrician</option>
                    <option value="roofer">Roofer</option>
                    <option value="kitchen-fitter">Kitchen Fitter</option>
                    <option value="bathroom-fitter">Bathroom Installer</option>
                    <option value="painter">Painter & Decorator</option>
                    <option value="landscaper">Landscaper</option>
                    <option value="flooring">Flooring Specialist</option>
                    <option value="hvac">HVAC Technician</option>
                    <option value="carpentry">Carpenter & Woodwork</option>
                    <option value="insulation">Insulation Specialist</option>
                    <option value="windows">Window & Door Specialist</option>
                </select>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label class="form-label">Budget Range (Optional)</label>
                    <div class="budget-slider-container">
                        <div class="budget-display">
                            <span id="budgetMin">¬£0</span>
                            <span class="budget-separator">to</span>
                            <span id="budgetMax">¬£50,000</span>
                        </div>
                        
                        <div class="dual-range-slider">
                            <input 
                                type="range" 
                                id="budgetMinSlider" 
                                min="0" 
                                max="100000" 
                                value="0" 
                                step="500"
                                oninput="updateBudgetMin(this.value)"
                            />
                            <input 
                                type="range" 
                                id="budgetMaxSlider" 
                                min="0" 
                                max="100000" 
                                value="50000" 
                                step="500"
                                oninput="updateBudgetMax(this.value)"
                            />
                        </div>
                        
                        <div class="budget-labels">
                            <span>¬£0</span>
                            <span>¬£100k+</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Property Type</label>
                    <select class="form-select" id="propertyType">
                        <option value="house">House</option>
                        <option value="apartment">Apartment</option>
                        <option value="commercial">Commercial</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Budget Range -->
            <div class="form-section" id="reviewSection" style="display: none;">
                <h3>Review Your Quote Request</h3>
                <div id="reviewContent" style="background: var(--light); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <!-- Review content will be populated by JavaScript -->
                </div>
                <button type="button" class="btn btn-full" id="submitBtn" onclick="submitQuote()">
                    Submit Quote Request ‚Üí
                </button>
            </div>
            
            <!-- Navigation Buttons -->
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px;">
                <button type="button" class="btn btn-outline" onclick="prevStep()">
                    ‚Üê Previous Step
                </button>
                <button type="button" class="btn btn-outline" id="nextBtnStep3" style="display: none;" onclick="nextStep()">
                    Continue ‚Üí
                </button>
            </div>
            
            <!-- Navigation Buttons -->
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px;">
                <button type="button" class="btn btn-outline" onclick="prevStep()">
                    ‚Üê Previous Step
                </button>
                <button type="button" class="btn btn-outline" id="nextBtnStep3" style="display: none;" onclick="nextStep()">
                    Continue ‚Üí
                </button>
            </div>
        <div class="form-section" id="reviewSection" style="display: none;">
            <h3>Review Your Quote Request</h3>
            <div id="reviewContent" style="background: var(--light); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <!-- Review content will be populated by JavaScript -->
            </div>
            <button class="btn btn-full" id="submitBtn" onclick="submitQuote()">
                Submit Quote Request
            </button>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">üéâ</div>
            <h2 class="success-title">Quote Submitted Successfully!</h2>
            <p class="success-message">
                Your quote request has been sent to verified tradespeople in your area. You'll start receiving quotes within 24 hours.
            </p>
            <div class="quote-id" id="quoteIdDisplay">
                Quote ID: <span id="quoteIdValue">LOADING...</span>
            </div>
            <div class="success-actions">
                <button class="btn btn-secondary" onclick="viewQuotes()">View My Quotes</button>
                <button class="btn" onclick="submitAnotherQuote()">Submit Another Quote</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="api.js"></script>
    <script src="auth.js"></script>
    <script src="quotes.js"></script>
    
    <script>
        // Quote Engine State
        let quoteData = {
            service: '',
            postcode: '',
            title: '',
            description: '',
            urgency: 'asap',
            budget: '',
            propertyType: 'house',
            tradeCategory: '' // For vendor registration
            experience: '' // For vendor registration
            company: '', // For vendor registration
            website: '' // For vendor registration
            phone: '' // For vendor registration
        };
        
        let currentStep = 1;
        
        // Initialize from URL parameters
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Pre-fill data from URL
            if (urlParams.get('service')) {
                quoteData.service = urlParams.get('service');
                selectService(quoteData.service);
            }
            if (urlParams.get('postcode')) {
                quoteData.postcode = urlParams.get('postcode');
                document.getElementById('postcode').value = quoteData.postcode;
            }
            if (urlParams.get('urgency')) {
                quoteData.urgency = urlParams.get('urgency');
                document.getElementById('urgency').value = quoteData.urgency;
            }
        });
        
        // Service Selection
        function selectService(serviceValue, icon, name) {
            quoteData.service = serviceValue;
            
            // Visual feedback with glassmorphism
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = event.target.closest('.service-card');
            selectedCard.classList.add('selected');
            
            // Add ripple effect
            const ripple = document.createElement('div');
            ripple.style.position = 'absolute';
            ripple.style.borderRadius = '50%';
            ripple.style.background = 'rgba(255, 255, 255, 0.3)';
            ripple.style.transform = 'scale(0)';
            ripple.style.animation = 'ripple 0.6s ease-out';
            selectedCard.appendChild(ripple);
            
            setTimeout(() => {
                ripple.style.transform = 'scale(4)';
                ripple.style.opacity = '0';
            }, 600);
            
            // Show next button
            document.getElementById('nextBtnStep1').style.display = 'block';
            
            // Auto-advance to step 2 after service selection with enhanced animation
            setTimeout(() => nextStep(), 800);
            
            quoteData.service = serviceValue;
            quoteData.icon = icon;
            quoteData.name = name;
        }
        
        // Navigation Functions
        function nextStep() {
            if (currentStep === 1 && !quoteData.service) {
                alert('Please select a service');
                return;
            }
            
            if (currentStep === 2) {
                // Validate step 2
                quoteData.postcode = document.getElementById('postcode').value;
                quoteData.title = document.getElementById('title').value;
                quoteData.description = document.getElementById('description').value;
                quoteData.urgency = document.getElementById('urgency').value;
                quoteData.budget = document.getElementById('budget').value;
                quoteData.propertyType = document.getElementById('propertyType').value;
                quoteData.tradeCategory = document.getElementById('tradeCategory').value;
                
                if (!quoteData.postcode || !quoteData.title) {
                    alert('Please fill in postcode and project title');
                    return;
                }
            }
            
            // Update progress
            updateProgress(currentStep + 1);
        }
        
        function prevStep() {
            updateProgress(currentStep - 1);
        }
        
        function updateProgress(step) {
            // Hide all sections
            document.getElementById('serviceSection').style.display = 'none';
            document.getElementById('detailsSection').style.display = 'none';
            document.getElementById('reviewSection').style.display = 'none';
            
            // Show relevant section
            if (step === 1) {
                document.getElementById('serviceSection').style.display = 'block';
            } else if (step === 2) {
                document.getElementById('detailsSection').style.display = 'block';
            } else if (step === 3) {
                document.getElementById('reviewSection').style.display = 'block';
                populateReview();
            }
            
            // Update step indicators
            for (let i = 1; i <= 3; i++) {
                const stepCircle = document.getElementById(`step${i}`);
                const stepLine = i < 3 ? document.getElementById(`line${i}`) : null;
                
                if (i < step) {
                    stepCircle.classList.add('completed');
                    stepCircle.classList.remove('active');
                    if (stepLine) stepLine.classList.add('completed');
                } else if (i === step) {
                    stepCircle.classList.add('active');
                    stepCircle.classList.remove('completed');
                    if (stepLine) stepLine.classList.remove('completed');
                } else {
                    stepCircle.classList.remove('active', 'completed');
                    if (stepLine) stepLine.classList.remove('completed');
                }
            }
            
            currentStep = step;
            
            // Auto-advance after service selection
            if (step === 1 && quoteData.service) {
                setTimeout(() => nextStep(), 1000);
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
            // Hide all sections
            document.getElementById('serviceSection').style.display = 'none';
            document.getElementById('detailsSection').style.display = 'none';
            document.getElementById('reviewSection').style.display = 'none';
            
            // Show relevant section
            if (step === 1) {
                document.getElementById('serviceSection').style.display = 'block';
            } else if (step === 2) {
                document.getElementById('detailsSection').style.display = 'block';
            } else if (step === 3) {
                document.getElementById('reviewSection').style.display = 'block';
                populateReview();
            }
            
            // Update step indicators
            for (let i = 1; i <= 3; i++) {
                const stepCircle = document.getElementById(`step${i}`);
                const stepLine = i < 3 ? document.getElementById(`line${i}`) : null;
                
                if (i < step) {
                    stepCircle.classList.add('completed');
                    stepCircle.classList.remove('active');
                    if (stepLine) stepLine.classList.add('completed');
                } else if (i === step) {
                    stepCircle.classList.add('active');
                    stepCircle.classList.remove('completed');
                    if (stepLine) stepLine.classList.remove('completed');
                } else {
                    stepCircle.classList.remove('active', 'completed');
                    if (stepLine) stepLine.classList.remove('completed');
                }
            }
            
            currentStep = step;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function populateReview() {
            const reviewContent = document.getElementById('reviewContent');
            const minBudget = document.getElementById('budgetMinSlider').value;
            const maxBudget = document.getElementById('budgetMaxSlider').value;
            const budgetText = minBudget === '0' && maxBudget === '100000' ? 'Any budget' : 
                              minBudget === '0' ? `Up to ${maxBudget >= 100000 ? '¬£100k+' : '¬£' + parseInt(maxBudget).toLocaleString()}` :
                              maxBudget >= 100000 ? `¬£${parseInt(minBudget).toLocaleString()}+` :
                              `¬£${parseInt(minBudget).toLocaleString()} - ¬£${parseInt(maxBudget).toLocaleString()}`;
            
            reviewContent.innerHTML = `
                <div style="display: grid; gap: 10px;">
                    <div><strong>Service:</strong> ${quoteData.service}</div>
                    <div><strong>Location:</strong> ${quoteData.postcode}</div>
                    <div><strong>Project:</strong> ${quoteData.title}</div>
                    <div><strong>Timeline:</strong> ${quoteData.urgency}</div>
                    <div><strong>Budget:</strong> ${budgetText}</div>
                    <div><strong>Property:</strong> ${quoteData.propertyType}</div>
                    ${quoteData.tradeCategory ? `<div><strong>Trade:</strong> ${quoteData.tradeCategory}</div>` : ''}
                    ${quoteData.description ? `<div style="margin-top: 15px;"><strong>Description:</strong><br>${quoteData.description}</div>` : ''}
                    ${quoteData.phone ? `<div><strong>Phone:</strong> ${quoteData.phone}</div>` : ''}
                    ${quoteData.company ? `<div><strong>Company:</strong> ${quoteData.company}</div>` : ''}
                    ${quoteData.website ? `<div><strong>Website:</strong> ${quoteData.website}</div>` : ''}
                </div>
            `;
        }
        
        function submitQuote() {
            // Check if user is authenticated
            if (window.api && window.api.isAuthenticated()) {
                // User is logged in, submit directly
                if (window.quoteEngine) {
                    window.quoteEngine.submitQuote(quoteData);
                }
            } else {
                // User not logged in, store data and show auth modal
                if (window.quoteEngine) {
                    window.quoteEngine.storePendingQuote(quoteData);
                    openAuthModal('register');
                } else {
                    // Fallback - show message
                    alert('Please create an account to submit quotes');
                }
            }
        }
        
        function viewQuotes() {
            closeSuccessModal();
            // Would navigate to quotes dashboard
            console.log('Navigate to quotes dashboard');
        }
        
        function submitAnotherQuote() {
            closeSuccessModal();
            // Reset form
            quoteData = {
                service: '',
                postcode: '',
                title: '',
                description: '',
                urgency: 'asap',
                budget: '',
                propertyType: 'house'
            };
            updateProgress(1);
        }
        
        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }
        
        // Auto-advance to step 2 if service is pre-selected
        setTimeout(() => {
            if (quoteData.service) {
                nextStep();
            }
        }, 500);
        
        // Budget Range Slider Functions
        function updateBudgetMin(value) {
            const min = parseInt(value);
            const max = parseInt(document.getElementById('budgetMaxSlider').value);
            
            if (min >= max) {
                document.getElementById('budgetMinSlider').value = max - 1000;
                return;
            }
            
            document.getElementById('budgetMin').textContent = 
                '¬£' + min.toLocaleString();
            quoteData.budgetMin = min;
        }

        function updateBudgetMax(value) {
            const max = parseInt(value);
            const min = parseInt(document.getElementById('budgetMinSlider').value);
            
            if (max <= min) {
                document.getElementById('budgetMaxSlider').value = min + 1000;
                return;
            }
            
            document.getElementById('budgetMax').textContent = 
                max >= 100000 ? '¬£100k+' : '¬£' + max.toLocaleString();
            quoteData.budgetMax = max;
        }

        // UK Postcode Database (Top 200 UK Postcodes)
        const ukPostcodes = [
            'SW1A 1AA', 'SW1A 2AA', 'SW1A 0AA', 'SW1A 1BB', 'EC1A 1BB',
            'W1A 0AX', 'W1A 1AA', 'M1 1AE', 'M1 1AA', 'M2 3AA',
            'B1 1AA', 'B1 1BB', 'B2 4AA', 'B3 1AA', 'BS1 1AA',
            'LS1 1UR', 'LS1 2UR', 'LS1 3AA', 'LS2 7EA', 'LS9 8AJ',
            'G1 1AA', 'G2 1AA', 'G3 6AA', 'G4 0AA', 'G5 0AA',
            'EH1 1YZ', 'EH1 2YY', 'EH2 2AA', 'EH3 6SS', 'EH8 9AB',
            'CF10 1EP', 'CF10 2DD', 'CF10 3AA', 'CF11 0AZ', 'CF23 9AD',
            'BT1 1AA', 'BT2 7AA', 'BT7 1EE', 'BT9 5FY', 'BT15 1DD',
            'AB10 1AB', 'AB11 6QE', 'AB12 3FG', 'AB15 6YQ', 'AB21 7BW',
            'NE1 1AA', 'NE2 1AE', 'NE3 1AA', 'NE4 5JB', 'NE6 1DA',
            'S1 1AA', 'S2 4AA', 'S3 7AA', 'S6 1BR', 'S9 3WF',
            'NG1 1AA', 'NG1 2AA', 'NG2 1AA', 'NG3 1AA', 'NG5 1AA',
            'CV1 1AA', 'CV2 2AA', 'CV3 1AA', 'CV4 7AA', 'CV5 6BB',
            'PL1 1AA', 'PL2 2AA', 'PL3 5AA', 'PL4 8AA', 'PL6 5TL',
            'SO14 0AA', 'SO15 1NQ', 'SO16 0AY', 'SO17 1BJ', 'SO18 1FT',
            'PO1 1AA', 'PO2 7AA', 'PO3 5AA', 'PO4 8AA', 'PO5 3LP',
            'BN1 1AA', 'BN2 5AA', 'BN3 1AA', 'BN41 1AP', 'BN43 6PB',
            'BR1 1AA', 'BR2 6AA', 'BR3 1AA', 'BR7 6AA', 'BR8 7AE',
            'CR0 1AA', 'CR2 6AA', 'CR3 1AA', 'CR4 1AA', 'CR5 2AA',
            'DA1 1AA', 'DA5 1AA', 'DA6 7AA', 'DA7 4AA', 'DA8 1AA',
            'E1 1AA', 'E1 2AN', 'E1 4SA', 'E1 6AN', 'E1 7BX',
            'EC1A 1BB', 'EC1M 3BB', 'EC2A 1DX', 'EC2M 3RR', 'EC3N 4AB',
            'EN1 1AA', 'EN2 6AA', 'EN3 4AA', 'EN4 8AA', 'EN5 1AA',
            'GU1 1AA', 'GU2 7AA', 'GU16 7AA', 'GU21 6AA', 'GU22 7AA',
            'HA1 1AA', 'HA2 0AA', 'HA3 5AA', 'HA4 6AA', 'HA5 1AA',
            'HP1 1AA', 'HP2 6AA', 'HP3 9AA', 'HP4 1AA', 'HP5 1AA',
            'IG1 1AA', 'IG2 6AA', 'IG3 9AA', 'IG4 5AA', 'IG6 1AA',
            'KT1 1AA', 'KT2 5AA', 'KT3 4AA', 'KT4 8AA', 'KT5 8AA',
            'N1 1AA', 'N2 0AA', 'N3 1AA', 'N4 1AA', 'N5 1AA',
            'NW1 1AA', 'NW2 1AA', 'NW3 1AA', 'NW4 1AA', 'NW5 1AA',
            'RM1 1AA', 'RM2 6AA', 'RM3 0AA', 'RM6 4AA', 'RM7 0AA',
            'SE1 1AA', 'SE2 9AA', 'SE3 8AA', 'SE4 1AA', 'SE5 7AA',
            'SG1 1AA', 'SG2 7AA', 'SG3 6AA', 'SG4 0AA', 'SG5 1AA',
            'SL1 1AA', 'SL2 5AA', 'SL3 7AA', 'SL4 5AA', 'SL6 2AA',
            'SM1 1AA', 'SM2 5AA', 'SM3 8AA', 'SM4 5AA', 'SM5 2AA',
            'SW1A 0AA', 'SW2 1AA', 'SW3 2AA', 'SW4 6AA', 'SW5 0TP',
            'TW1 1AA', 'TW2 5AA', 'TW3 1AA', 'TW4 5AA', 'TW5 9QR',
            'UB1 1AA', 'UB2 4AA', 'UB3 1AA', 'UB4 8AA', 'UB5 5AA',
            'W1A 0AX', 'W1K 1AA', 'W1S 1AA', 'W1U 1AA', 'W1W 6AA',
            'WD1 1AA', 'WD2 4AA', 'WD3 3AA', 'WD4 4AA', 'WD5 0AA',
            'WC1A 0AA', 'WC1B 3BA', 'WC1E 6BT', 'WC1H 9EQ', 'WC2A 2AA'
        ];

        // UK Postcode Validation and Autocomplete
        function validatePostcode(input) {
            const value = input.toUpperCase().trim();
            const postcodeRegex = /^([A-Z]{1,2}\d{1,2}[A-Z]?)\s?(\d[A-Z]{2})$/i;
            const validationDiv = document.getElementById('postcodeValidation');
            const suggestionsDiv = document.getElementById('postcodesuggestions');
            
            if (value.length < 2) {
                validationDiv.innerHTML = '';
                suggestionsDiv.innerHTML = '';
                return;
            }
            
            // Check if valid format
            if (postcodeRegex.test(value)) {
                validationDiv.innerHTML = '<span style="color: green;">‚úì Valid UK postcode</span>';
                suggestionsDiv.innerHTML = '';
            } else if (value.length >= 3) {
                validationDiv.innerHTML = '<span style="color: orange;">‚ö† Please enter a valid UK postcode</span>';
                
                // Show suggestions from our database
                const matches = ukPostcodes.filter(pc => 
                    pc.startsWith(value.substring(0, 3))
                ).slice(0, 5);
                
                if (matches.length > 0) {
                    suggestionsDiv.innerHTML = matches.map(pc => 
                        `<div class="postcode-suggestion" onclick="selectPostcode('${pc}')">
                            ${pc}
                        </div>`
                    ).join('');
                } else {
                    suggestionsDiv.innerHTML = '';
                }
            }
        }

        function selectPostcode(postcode) {
            document.getElementById('postcode').value = postcode;
            validatePostcode(document.getElementById('postcode'));
            document.getElementById('postcodesuggestions').innerHTML = '';
        }

        // Google Maps Location Services
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // Use Google Maps Geocoding API
                        const geocoder = new google.maps.Geocoder();
                        geocoder.geocode({
                            location: {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            },
                            }, (results, status) => {
                                if (status === 'OK') {
                                    const location = results[0];
                                    document.getElementById('postcode').value = location.formatted_address || '';
                                    
                                    // Extract postcode from formatted address
                                    const postcode = location.address_components.postcode || location.formatted_address;
                                    if (postcode) {
                                        document.getElementById('postcode').value = postcode;
                                    }
                                    
                                    // Show success message
                                    const btn = event.target;
                                    const originalText = btn.textContent;
                                    btn.textContent = '‚úÖ Location Found!';
                                    btn.style.background = '#D4EDDA';
                                    btn.style.color = '#155724';
                                    
                                    setTimeout(() => {
                                        btn.textContent = originalText;
                                        btn.style.background = '';
                                        btn.style.color = '';
                                    }, 2000);
                                } else {
                                    alert('Unable to get your location. Please enter postcode manually.');
                                }
                            },
                            (error) => {
                                console.error('Geocoding failed:', error);
                                alert('Location services unavailable. Please enter postcode manually.');
                            }
                        );
                    } else {
                        // Fallback to manual entry
                        alert('Location services unavailable. Please enter postcode manually.');
                    }
                } else {
                    // Fallback to manual entry
                    alert('Location services unavailable. Please enter postcode manually.');
                }
            } else {
                // Fallback to manual entry
                alert('Location services unavailable. Please enter postcode manually.');
            }
        }
        
        // Enhanced postcode validation
        function validatePostcode(postcode) {
            // UK postcode validation
            const postcodeRegex = /^[A-Z]{1,2}[A-Z]{1,2}[A-Z]{1,2}[A-Z]{1,2}\s*[A-Z]{1,2}$/i;
            return postcodeRegex.test(postcode);
        }
        
        // Auto-fill location when service is selected
        function autoFillLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const geocoder = new google.maps.Geocoder();
                        geocoder.geocode({
                            location: {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            },
                            (results, status) => {
                                if (status === 'OK') {
                                    const location = results[0];
                                    const postcode = location.address_components.postcode || location.formatted_address || '';
                                    if (postcode) {
                                        document.getElementById('postcode').value = postcode;
                                    }
                                }
                            }
                        },
                        (error) => {
                            console.log('Geocoding failed:', error);
                        }
                    );
                }
            }
        }
        }, 500);
        
        // AI Quote Generation
        function generateWithAI() {
            const service = quoteData.service;
            const postcode = document.getElementById('postcode').value;
            
            if (!service || !postcode) {
                alert('Please select a service and enter your postcode first');
                return;
            }
            
            // AI-generated descriptions based on service type
            const aiDescriptions = {
                'extension': 'I need a single storey extension to create additional living space at the rear of my property. The extension should be approximately 4m x 3m with proper foundations and connecting to existing utilities.',
                'loft': 'Looking to convert my loft space into a usable bedroom or home office. Need proper insulation, windows, and staircase installation. Must comply with building regulations.',
                'kitchen': 'Complete kitchen renovation required including new cabinets, worktops, appliances installation, plumbing, and electrical work. Open-plan design preferred with island unit.',
                'bathroom': 'Full bathroom renovation needed including removal of old fittings, new suite installation, tiling, and plumbing work. Need proper ventilation and waterproofing.',
                'roofing': 'Roof replacement or repair needed. Looking for complete re-roofing with proper insulation and new guttering system. Current roof has multiple leaks.',
                'electrical': 'Electrical rewiring required for 3-bedroom house. Need new consumer unit, socket installations, and full testing. Must be Part P certified.',
                'plumbing': 'Complete bathroom and kitchen plumbing installation. Need new pipes, fixtures, and water heater installation. Current system is old and inefficient.',
                'flooring': 'Hardwood flooring installation throughout ground floor. Looking for oak or similar quality wood with proper underlay and finishing.',
                'painting': 'Interior painting required for 4-bedroom house. Need walls, ceilings, and woodwork preparation with high-quality paint.',
                'landscaping': 'Complete garden redesign including new lawn, planting scheme, patio area, and irrigation system. Current garden is overgrown.',
                'carpentry': 'Custom carpentry and woodworking services for bespoke furniture, cabinets, and architectural features. Need skilled craftsmen for precision work.',
                'hvac': 'Heating, ventilation, and air conditioning installation and maintenance. Need certified HVAC technicians for proper system design and energy efficiency.',
                'insulation': 'Professional insulation services including cavity wall, loft, and external wall insulation for improved energy efficiency and comfort.',
                'windows': 'Window and door installation and replacement services. Need double glazing, proper fitting, and weatherproofing for optimal performance.'
            };
                'loft': 'Looking to convert my loft space into a usable bedroom or home office. Need proper insulation, windows, and staircase installation. Must comply with building regulations.',
                'kitchen': 'Complete kitchen renovation required including new cabinets, worktops, appliances installation, plumbing, and electrical work. Open-plan design preferred with island unit.',
                'bathroom': 'Full bathroom renovation needed including removal of old fittings, new suite installation, tiling, plumbing, and electrical work. Need proper ventilation and waterproofing.',
                'roofing': 'Roof replacement or repair needed. Looking for complete re-roofing with proper insulation and new guttering system. Current roof has multiple leaks.',
                'electrical': 'Electrical rewiring required for 3-bedroom house. Need new consumer unit, socket installations, and full testing. Must be Part P certified.',
                'plumbing': 'Complete bathroom and kitchen plumbing installation. Need new pipes, fixtures, and water heater installation. Current system is old and inefficient.',
                'flooring': 'Hardwood flooring installation throughout ground floor. Looking for oak or similar quality wood with proper underlay and finishing.',
                'painting': 'Interior painting required for 4-bedroom house. Need walls, ceilings, and woodwork preparation with high-quality paint.',
                'landscaping': 'Complete garden redesign including new lawn, planting scheme, patio area, and irrigation system. Current garden is overgrown.'
            };
            
            // Generate a professional title
            const titles = {
                'extension': 'House Extension Quote Request',
                'loft': 'Loft Conversion Quote Request',
                'kitchen': 'Kitchen Renovation Quote Request',
                'bathroom': 'Bathroom Renovation Quote Request',
                'roofing': 'Roofing Work Quote Request',
                'electrical': 'Electrical Installation Quote Request',
                'plumbing': 'Plumbing Installation Quote Request',
                'flooring': 'Flooring Installation Quote Request',
                'painting': 'Interior Painting Quote Request',
                'landscaping': 'Landscaping Quote Request',
                'carpentry': 'Carpentry & Woodwork Quote Request',
                'hvac': 'HVAC Installation Quote Request',
                'insulation': 'Insulation Installation Quote Request',
                'windows': 'Window Installation Quote Request'
            };
            
            // Auto-fill the form with AI-generated content
            document.getElementById('title').value = titles[service] || 'Home Improvement Quote Request';
            document.getElementById('description').value = aiDescriptions[service] || 'Need professional services for home improvement project.';
            
            // Show success message
            const aiButton = event.target;
            const originalText = aiButton.textContent;
            aiButton.textContent = '‚úÖ Generated!';
            aiButton.style.background = '#D4EDDA';
            aiButton.style.color = '#155724';
            
            setTimeout(() => {
                aiButton.textContent = originalText;
                aiButton.style.background = '';
                aiButton.style.color = '';
            }, 2000);
        }
        
        // Handle quote submission success
        window.addEventListener('quoteSubmitted', (event) => {
            const quoteId = event.detail.quoteId;
            document.getElementById('quoteIdValue').textContent = quoteId;
            document.getElementById('successModal').classList.add('active');
        });
    </script>
</body>
</html>