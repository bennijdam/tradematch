<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotes - TradeMatch Customer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2300E5A0'/%3E%3Cstop offset='100%25' style='stop-color:%2342A5F5'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-family='Arial, sans-serif' font-size='60' font-weight='800' fill='%23ffffff' text-anchor='middle'%3ET%3C/text%3E%3C/svg%3E">
    <style>
        body {
            font-family: 'Archivo', sans-serif;
            background: #0A0E14;
            color: #FFFFFF;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .loader {
            text-align: center;
            font-size: 16px;
            color: #9CA3AF;
        }
        .loader a {
            color: #00E5A0;
            text-decoration: none;
        }
        .loader a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="loader">
        Loading quotes experience...<br>
        <noscript>
            JavaScript is required. Open
            <a href="your-quotes.html">your-quotes.html</a>.
        </noscript>
    </div>

    <script>
        (async () => {
            try {
                const response = await fetch('your-quotes.html', { cache: 'no-store' });
                if (!response.ok) {
                    throw new Error('Failed to load quotes content');
                }

                const html = await response.text();
                document.open();
                document.write(html);
                document.close();

                if (window.history && window.history.replaceState) {
                    window.history.replaceState({}, '', 'quotes.html');
                }
            } catch (error) {
                const container = document.querySelector('.loader');
                if (container) {
                    container.innerHTML = 'Unable to load quotes right now. '
                        + '<a href="your-quotes.html">Open Your Quotes</a>.';
                }
            }
        })();
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotes - TradeMatch Customer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2300E5A0'/%3E%3Cstop offset='100%25' style='stop-color:%2342A5F5'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-family='Arial, sans-serif' font-size='60' font-weight='800' fill='%23ffffff' text-anchor='middle'%3ET%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" href="../styles/styles.css">
</head>
<body>
    <div class="ambient-bg"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="dashboard.html" class="logo">
                <div class="logo-icon">T</div>
                <span class="logo-text">TradeMatch</span>
            </a>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main</div>
                <a href="dashboard.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="my-jobs.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                    <span class="nav-text">My Jobs</span>
                </a>
                <a href="quotes.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="nav-text">Quotes</span>
                </a>
                <a href="messages.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                    </svg>
                    <span class="nav-text">Messages</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Trades</div>
                <a href="saved-trades.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                    <span class="nav-text">Saved Trades</span>
                </a>
                <a href="reviews.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    <span class="nav-text">Reviews</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Account</div>
                <a href="notifications.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                    <span class="nav-text">Notifications</span>
                </a>
                <a href="billing.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                    </svg>
                    <span class="nav-text">Billing</span>
                </a>
                <a href="settings.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <span class="nav-text">Settings</span>
                </a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <button class="collapse-btn" id="collapseBtn">
                <svg class="collapse-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                </svg>
            </button>
        </div>
    </aside>

    <!-- Top Navigation with Modals -->
<header class="top-nav" id="topNav">
    <div class="top-nav-left">
        <div class="search-container">
            <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input type="text" class="search-input" placeholder="Search jobs, quotes, messages...">
        </div>
    </div>

    <div class="top-nav-right">
        <div class="theme-toggle" id="themeToggle">
            <div class="theme-toggle-slider">
                <svg class="theme-toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
            </div>
        </div>

        <!-- Notification Button with Modal -->
        <div class="notification-modal-container">
            <button class="icon-button" id="notificationBtn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
                <span class="notification-badge"></span>
            </button>

            <!-- Notification Modal -->
            <div class="top-bar-modal notification-modal" id="notificationModal">
                <div class="notification-modal-header">
                    <h3 class="notification-modal-title">Notifications</h3>
                    <button class="mark-all-read" id="markAllRead">Mark all read</button>
                </div>
                <div class="notification-modal-body">
                    <div class="notification-item unread" data-link="quotes.html">
                        <div class="notification-icon quote">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">New quote received from Elite Builders for Kitchen Renovation</div>
                            <div class="notification-time">2 hours ago</div>
                        </div>
                    </div>

                    <div class="notification-item unread" data-link="messages.html">
                        <div class="notification-icon message">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">Green Gardens Ltd sent you a message about Garden Landscaping</div>
                            <div class="notification-time">5 hours ago</div>
                        </div>
                    </div>

                    <div class="notification-item" data-link="reviews.html">
                        <div class="notification-icon review">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">Please leave a review for PowerPro Electricians</div>
                            <div class="notification-time">1 day ago</div>
                        </div>
                    </div>

                    <div class="notification-item" data-link="quotes.html">
                        <div class="notification-icon quote">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">New quote received from Quick Fix Plumbing for Bathroom Plumbing</div>
                            <div class="notification-time">2 days ago</div>
                        </div>
                    </div>
                </div>
                <div class="notification-modal-footer">
                    <a href="notifications.html" class="view-all-link">View all notifications</a>
                </div>
            </div>
        </div>

        <!-- Profile Menu with Modal -->
        <div class="profile-modal-container">
            <div class="user-menu" id="profileMenuBtn">
                <div class="user-avatar">JD</div>
                <div class="user-info">
                    <div class="user-name">John Doe</div>
                    <div class="user-role">Customer</div>
                </div>
            </div>

            <!-- Profile Modal -->
            <div class="top-bar-modal profile-modal" id="profileModal">
                <div class="profile-modal-header">
                    <div class="profile-modal-avatar">JD</div>
                    <div class="profile-modal-info">
                        <div class="profile-modal-name">John Doe</div>
                        <div class="profile-modal-role">Customer</div>
                    </div>
                </div>
                <div class="profile-modal-menu">
                    <a href="profile.html" class="profile-menu-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        My Profile
                    </a>
                    <a href="settings.html" class="profile-menu-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        Account Settings
                    </a>
                    <a href="billing.html" class="profile-menu-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                        </svg>
                        Billing
                    </a>
                    <div class="profile-menu-divider"></div>
                    <a href="#" class="profile-menu-item logout" id="logoutBtn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Modal Backdrop -->
<div class="modal-backdrop" id="modalBackdrop"></div>


    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="page-header">
            <div>
                <h1 class="page-title">Quotes</h1>
                <p class="page-subtitle">This page is ready for implementation</p>
            </div>
        </div>

        <div class="settings-container">
            <div class="settings-section">
                <h3 class="settings-section-title">Your Quotes</h3>
                <div id="quotesEmptyState" style="color: var(--text-secondary);">Loading quotesâ€¦</div>
                <div class="table-wrapper" id="quotesTableWrapper" style="display:none;">
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Postcode</th>
                                <th>Status</th>
                                <th>Bids</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quotesTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script src="../dashboardApp.js"></script>
    <script>
        const API_BASE = 'http://localhost:5000/api';

        function getStoredUser() {
            const rawUser = localStorage.getItem('user');
            if (!rawUser) return null;
            try {
                return JSON.parse(rawUser);
            } catch (error) {
                console.warn('Failed to parse stored user data:', error);
                return null;
            }
        }

        function getToken() {
            return localStorage.getItem('token');
        }

        function formatDate(value) {
            if (!value) return '';
            const date = new Date(value);
            if (Number.isNaN(date.getTime())) return '';
            return date.toLocaleDateString('en-GB');
        }

        async function fetchQuotes(customerId) {
            const token = getToken();
            const response = await fetch(`${API_BASE}/quotes/customer/${customerId}`, {
                headers: { Authorization: `Bearer ${token}` }
            });
            const data = await response.json().catch(() => ({}));
            if (!response.ok || !data.success) {
                throw new Error(data.error || 'Failed to load quotes');
            }
            return data.quotes || [];
        }

        async function updateQuoteStatus(quoteId, status) {
            const token = getToken();
            const response = await fetch(`${API_BASE}/quotes/${quoteId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${token}`
                },
                body: JSON.stringify({ status })
            });
            const data = await response.json().catch(() => ({}));
            if (!response.ok || !data.success) {
                throw new Error(data.error || 'Failed to update quote');
            }
            return true;
        }

        function renderQuotes(quotes) {
            const emptyState = document.getElementById('quotesEmptyState');
            const tableWrapper = document.getElementById('quotesTableWrapper');
            const tableBody = document.getElementById('quotesTableBody');

            if (!quotes.length) {
                emptyState.textContent = 'No quotes yet. Post a job to receive quotes.';
                tableWrapper.style.display = 'none';
                return;
            }

            emptyState.textContent = '';
            tableWrapper.style.display = 'block';
            tableBody.innerHTML = '';

            quotes.forEach(quote => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${quote.title || quote.serviceType || 'Quote'}</td>
                    <td>${quote.postcode || '-'}</td>
                    <td>${quote.status || 'open'}</td>
                    <td>${quote.bidCount ?? 0}</td>
                    <td>${formatDate(quote.createdAt)}</td>
                    <td>
                        <button class="btn btn-primary" data-action="award" data-id="${quote.id}">Close</button>
                        <button class="btn btn-secondary" data-action="cancel" data-id="${quote.id}">Cancel</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            tableBody.querySelectorAll('button[data-action]').forEach(button => {
                button.addEventListener('click', async () => {
                    const quoteId = button.getAttribute('data-id');
                    const action = button.getAttribute('data-action');
                    const status = action === 'award' ? 'closed' : 'cancelled';
                    try {
                        await updateQuoteStatus(quoteId, status);
                        button.closest('tr').querySelector('td:nth-child(3)').textContent = status;
                    } catch (error) {
                        console.error(error);
                    }
                });
            });
        }

        async function initQuotes() {
            const user = getStoredUser();
            if (!user || !user.id) return;
            try {
                const quotes = await fetchQuotes(user.id);
                renderQuotes(quotes);
            } catch (error) {
                const emptyState = document.getElementById('quotesEmptyState');
                emptyState.textContent = error.message || 'Failed to load quotes.';
            }
        }

        window.addEventListener('load', initQuotes);
    </script>
</body>
</html>
