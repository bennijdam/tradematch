<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review & Add-Ons - TradeMatch Customer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2300E5A0'/%3E%3Cstop offset='100%25' style='stop-color:%2342A5F5'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='20' fill='url(%23g)'/%3E%3Ctext x='50' y='70' font-family='Arial, sans-serif' font-size='60' font-weight='800' fill='%23ffffff' text-anchor='middle'%3ET%3C/text%3E%3C/svg%3E">
    <link rel="stylesheet" href="../styles/styles.css">
    <style>
/* ========================================
   REVIEWS PAGE STYLES
   Add these to your existing ../styles/styles.css
   ======================================== */

/* Info Banner */
.info-banner {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: var(--surface-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 32px;
}

.info-banner-icon {
    width: 20px;
    height: 20px;
    color: #42A5F5;
    flex-shrink: 0;
    margin-top: 2px;
}

[data-theme="light"] .info-banner-icon {
    color: #3B82F6;
}

.info-banner-content {
    flex: 1;
}

.info-banner-text {
    font-size: 14px;
    line-height: 1.5;
    color: var(--text-secondary);
    margin: 0;
}

/* Review Section */
.review-section {
    margin-bottom: 48px;
}

.section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
}

.section-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.section-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;
    height: 24px;
    padding: 0 8px;
    background: rgba(66, 165, 245, 0.15);
    color: #42A5F5;
    font-size: 13px;
    font-weight: 600;
    border-radius: 12px;
}

[data-theme="light"] .section-count {
    background: rgba(59, 130, 246, 0.15);
    color: #3B82F6;
}

/* Reviews Grid */
.reviews-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 20px;
}

@media (max-width: 768px) {
    .reviews-grid {
        grid-template-columns: 1fr;
    }
}

/* Review Card Base */
.review-card {
    background: var(--surface-primary);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s ease;
}

.review-card:hover {
    border-color: var(--border-hover);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.review-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 16px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border-color);
}

.vendor-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.vendor-avatar {
    width: 48px;
    height: 48px;
    background: var(--surface-secondary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.vendor-avatar svg {
    width: 24px;
    height: 24px;
    color: var(--text-tertiary);
}

.vendor-details {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.vendor-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.vendor-trade-badge {
    display: inline-block;
    padding: 4px 10px;
    background: var(--surface-secondary);
    color: var(--text-secondary);
    font-size: 12px;
    font-weight: 500;
    border-radius: 4px;
    font-family: 'Space Mono', monospace;
}

/* Review Status Badge (for submitted reviews) */
.review-status-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: rgba(66, 165, 245, 0.15);
    color: #42A5F5;
    font-size: 12px;
    font-weight: 600;
    border-radius: 6px;
    font-family: 'Space Mono', monospace;
}

[data-theme="light"] .review-status-badge {
    background: rgba(59, 130, 246, 0.15);
    color: #3B82F6;
}

.review-status-badge .status-icon {
    width: 14px;
    height: 14px;
}

/* Review Card Body */
.review-card-body {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.job-detail-row {
    display: flex;
    align-items: flex-start;
    gap: 10px;
}

.job-detail-icon {
    width: 16px;
    height: 16px;
    color: var(--text-tertiary);
    flex-shrink: 0;
    margin-top: 2px;
}

.job-detail-text {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* Review Comment (submitted reviews) */
.review-comment {
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-primary);
    margin: 16px 0 0 0;
}

.review-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border-color);
}

.review-date {
    font-size: 13px;
    color: var(--text-tertiary);
}

/* Review Card Footer */
.review-card-footer {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border-color);
}

/* Star Rating Display (for submitted reviews) */
.star-rating-display {
    display: flex;
    gap: 4px;
    margin-bottom: 16px;
}

.star-rating-display .star-icon {
    width: 20px;
    height: 20px;
    color: var(--text-tertiary);
}

.star-rating-display .star-icon.filled {
    color: #FFA726;
}

/* Empty State */
.empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 64px 32px;
    text-align: center;
}

.empty-state-icon {
    width: 64px;
    height: 64px;
    color: var(--text-tertiary);
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-state-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 8px 0;
}

.empty-state-text {
    font-size: 14px;
    color: var(--text-secondary);
    margin: 0;
    max-width: 400px;
}

/* Verification Note */
.verification-note {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: var(--surface-secondary);
    border-radius: 8px;
    margin-top: 32px;
}

.verification-icon {
    width: 20px;
    height: 20px;
    color: #42A5F5;
    flex-shrink: 0;
    margin-top: 2px;
}

[data-theme="light"] .verification-icon {
    color: #3B82F6;
}

.verification-text {
    font-size: 13px;
    line-height: 1.5;
    color: var(--text-secondary);
    margin: 0;
}

/* Filter Select */
.filter-select {
    padding: 8px 32px 8px 12px;
    background: var(--surface-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 14px;
    color: var(--text-primary);
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23666'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 20px;
}

.filter-select:hover {
    border-color: var(--border-hover);
}

.filter-select:focus {
    outline: none;
    border-color: var(--accent-primary);
}

/* ========================================
   REVIEW MODAL STYLES
   ======================================== */

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 14, 20, 0.72);
    backdrop-filter: blur(6px) saturate(120%);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
}

.modal-container {
    background: var(--surface-primary, #FFFFFF);
    color: var(--text-primary, #111827);
    border-radius: 16px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 24px 80px rgba(0, 0, 0, 0.35);
    border: 1px solid var(--border-color, rgba(15, 23, 42, 0.12));
    position: relative;
}

.review-modal {
    max-width: 680px;
    overflow: hidden;
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px;
    border-bottom: 1px solid var(--border-color, rgba(15, 23, 42, 0.1));
    background: linear-gradient(135deg, rgba(0, 229, 160, 0.08), rgba(66, 165, 245, 0.08));
}

.modal-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.modal-close {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-tertiary);
    transition: all 0.2s ease;
}

.modal-close:hover {
    background: var(--surface-secondary);
    color: var(--text-primary);
}

.modal-close svg {
    width: 20px;
    height: 20px;
}

.modal-body {
    padding: 24px;
    background: var(--surface-primary, #FFFFFF);
}

/* Vendor Info in Modal */
.review-modal-vendor-info {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--surface-secondary, rgba(148, 163, 184, 0.12));
    border-radius: 8px;
    margin-bottom: 24px;
    border: 1px solid var(--border-color, rgba(15, 23, 42, 0.08));
}

.review-modal-vendor-info .vendor-avatar {
    width: 56px;
    height: 56px;
}

.review-modal-vendor-info .vendor-avatar svg {
    width: 28px;
    height: 28px;
}

/* Star Rating Selector */
.star-rating-selector {
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
    gap: 8px;
}

.star-rating-selector input[type="radio"] {
    display: none;
}

.star-label {
    cursor: pointer;
    transition: all 0.2s ease;
}

.star-label .star-icon {
    width: 32px;
    height: 32px;
    color: var(--text-tertiary);
    transition: all 0.2s ease;
}

.star-label:hover .star-icon,
.star-label:hover ~ .star-label .star-icon {
    color: #FFA726;
    transform: scale(1.1);
}

.star-rating-selector input[type="radio"]:checked ~ .star-label .star-icon,
.star-rating-selector input[type="radio"]:checked + .star-label .star-icon {
    color: #FFA726;
}

/* Form Groups */
.form-group {
    margin-bottom: 24px;
}

.form-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
}

.required {
    color: var(--status-danger);
}

.form-textarea {
    width: 100%;
    padding: 12px;
    background: var(--surface-primary, #FFFFFF);
    border: 1px solid var(--border-color, rgba(15, 23, 42, 0.15));
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.5;
    color: var(--text-primary);
    font-family: 'Archivo', sans-serif;
    resize: vertical;
    transition: all 0.2s ease;
}

.form-textarea:hover {
    border-color: var(--border-hover);
}

.form-textarea:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px var(--accent-primary-alpha);
}

.form-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
}

.form-help {
    font-size: 13px;
    color: var(--text-tertiary);
    margin: 0;
}

.char-counter {
    font-size: 13px;
    color: var(--text-tertiary);
    font-family: 'Space Mono', monospace;
}

/* Review Notice */
.review-notice {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    background: var(--status-warning-bg);
    border: 1px solid var(--status-warning);
    border-radius: 8px;
    margin-bottom: 24px;
}

.notice-icon {
    width: 20px;
    height: 20px;
    color: var(--status-warning);
    flex-shrink: 0;
    margin-top: 2px;
}

.notice-text {
    font-size: 13px;
    line-height: 1.5;
    color: var(--text-primary);
    margin: 0;
}

/* Modal Footer */
.modal-footer {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

[data-theme="dark"] .modal-overlay {
    background: rgba(8, 12, 18, 0.8);
}

[data-theme="dark"] .modal-container {
    background: var(--surface-primary, #0B1220);
    border-color: rgba(148, 163, 184, 0.2);
}

[data-theme="dark"] .modal-header {
    background: linear-gradient(135deg, rgba(0, 229, 160, 0.12), rgba(66, 165, 245, 0.12));
}

/* Success Modal */
.success-modal {
    max-width: 400px;
    text-align: center;
    padding: 40px 24px 24px;
}

.success-icon-wrapper {
    width: 72px;
    height: 72px;
    margin: 0 auto 24px;
    background: rgba(66, 165, 245, 0.15);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

[data-theme="light"] .success-icon-wrapper {
    background: rgba(59, 130, 246, 0.15);
}

.success-icon {
    width: 40px;
    height: 40px;
    color: #42A5F5;
}

[data-theme="light"] .success-icon {
    color: #3B82F6;
}

.success-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 12px 0;
}

.success-text {
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-secondary);
    margin: 0 0 32px 0;
}

/* Responsive Modal */
@media (max-width: 768px) {
    .modal-container {
        max-width: 100%;
        border-radius: 16px 16px 0 0;
        max-height: 95vh;
    }
    
    .modal-overlay {
        align-items: flex-end;
        padding: 0;
    }
    
    .star-label .star-icon {
        width: 28px;
        height: 28px;
    }
}

/* Dark Theme Adjustments */
[data-theme="dark"] .info-banner,
[data-theme="dark"] .verification-note {
    background: rgba(255, 255, 255, 0.03);
}

[data-theme="dark"] .review-notice {
    background: rgba(255, 167, 38, 0.1);
}

[data-theme="dark"] .filter-select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23999'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
}

/* Animation for modal entrance */
@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-overlay[style*="flex"] .modal-container {
    animation: slideUp 0.3s ease-out;
}

    </style>
</head>
<body>
    <div class="ambient-bg"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="index.html" class="logo">
                <div class="logo-icon">T</div>
                <span class="logo-text">TradeMatch</span>
            </a>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main</div>
                <a href="index.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="my-jobs.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                    <span class="nav-text">My Jobs</span>
                </a>
                <a href="quotes.html" class="nav-item active">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="nav-text">Quotes</span>
                </a>
                <a href="messages.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                    </svg>
                    <span class="nav-text">Messages</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Trades</div>
                <a href="saved-trades.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                    <span class="nav-text">Saved Trades</span>
                </a>
                <a href="reviews.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    <span class="nav-text">Reviews</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Account</div>
                <a href="notifications.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                    <span class="nav-text">Notifications</span>
                </a>
                <a href="settings.html" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <span class="nav-text">Settings</span>
                </a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <button class="collapse-btn" id="collapseBtn">
                <svg class="collapse-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                </svg>
            </button>
        </div>
    </aside>

    <!-- Top Navigation -->
    <!-- Top Navigation with Modals -->
<header class="top-nav" id="topNav">
    <div class="top-nav-left">
        <div class="search-container">
            <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input type="text" class="search-input" placeholder="Search jobs, quotes, messages...">
        </div>
    </div>

    <div class="top-nav-right">
        <div class="theme-toggle" id="themeToggle">
            <div class="theme-toggle-slider">
                <svg class="theme-toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
            </div>
        </div>

        <!-- Notification Button with Modal -->
        <div class="notification-modal-container">
            <button class="icon-button" id="notificationBtn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
                <span class="notification-badge"></span>
            </button>

            <!-- Notification Modal -->
            <div class="top-bar-modal notification-modal" id="notificationModal">
                <div class="notification-modal-header">
                    <h3 class="notification-modal-title">Notifications</h3>
                    <button class="mark-all-read" id="markAllRead">Mark all read</button>
                </div>
                <div class="notification-modal-body">
                    <div class="notification-item unread" data-link="quotes.html">
                        <div class="notification-icon quote">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">New quote received from Elite Builders for Kitchen Renovation</div>
                            <div class="notification-time">2 hours ago</div>
                        </div>
                    </div>

                    <div class="notification-item unread" data-link="messages.html">
                        <div class="notification-icon message">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">Green Gardens Ltd sent you a message about Garden Landscaping</div>
                            <div class="notification-time">5 hours ago</div>
                        </div>
                    </div>

                    <div class="notification-item" data-link="reviews.html">
                        <div class="notification-icon review">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">Please leave a review for PowerPro Electricians</div>
                            <div class="notification-time">1 day ago</div>
                        </div>
                    </div>

                    <div class="notification-item" data-link="quotes.html">
                        <div class="notification-icon quote">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div class="notification-content">
                            <div class="notification-text">New quote received from Quick Fix Plumbing for Bathroom Plumbing</div>
                            <div class="notification-time">2 days ago</div>
                        </div>
                    </div>
                </div>
                <div class="notification-modal-footer">
                    <a href="notifications.html" class="view-all-link">View all notifications</a>
                </div>
            </div>
        </div>

        <!-- Profile Menu with Modal -->
        <div class="profile-modal-container">
            <div class="user-menu" id="profileMenuBtn">
                <div class="user-avatar">JD</div>
                <div class="user-info">
                    <div class="user-name">John Doe</div>
                    <div class="user-role">Customer</div>
                </div>
            </div>

            <!-- Profile Modal -->
            <div class="top-bar-modal profile-modal" id="profileModal">
                <div class="profile-modal-header">
                    <div class="profile-modal-avatar">JD</div>
                    <div class="profile-modal-info">
                        <div class="profile-modal-name">John Doe</div>
                        <div class="profile-modal-role">Customer</div>
                    </div>
                </div>
                <div class="profile-modal-menu">
                    <a href="profile.html" class="profile-menu-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        My Profile
                    </a>
                    <a href="settings.html" class="profile-menu-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        Account Settings
                    </a>
                    <div class="profile-menu-divider"></div>
                    <a href="#" class="profile-menu-item logout" id="logoutBtn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        Logout
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Modal Backdrop -->
<div class="modal-backdrop" id="modalBackdrop"></div>


    <!-- Main Content -->

<!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="content-wrapper">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Reviews</h1>
                    <p class="page-subtitle">Share your experience and help others choose trusted tradespeople</p>
                </div>
                <div class="page-header-actions">
                    <select class="filter-select" id="reviewFilter">
                        <option value="all">All</option>
                        <option value="pending">Pending reviews</option>
                        <option value="submitted">Submitted reviews</option>
                    </select>
                </div>
            </div>

            <!-- Trust Info Banner -->
            <div class="info-banner">
                <svg class="info-banner-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
                <div class="info-banner-content">
                    <p class="info-banner-text">Reviews help keep TradeMatch fair and transparent. All reviews are linked to real jobs and cannot be edited or removed by tradespeople.</p>
                </div>
            </div>

            <!-- Pending Reviews Section -->
            <div class="review-section" id="pendingSection">
                <div class="section-header">
                    <h2 class="section-title">Pending Reviews</h2>
                    <span class="section-count" id="pendingCount">2</span>
                </div>

                <div class="reviews-grid" id="pendingGrid">
                    <!-- Pending Review Card 1 -->
                    <div class="review-card pending-review-card" data-job-id="job-1">
                        <div class="review-card-header">
                            <div class="vendor-info">
                                <div class="vendor-avatar">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <div class="vendor-details">
                                    <h3 class="vendor-name">Mike Thompson</h3>
                                    <span class="vendor-trade-badge">Plumber</span>
                                </div>
                            </div>
                        </div>
                        <div class="review-card-body">
                            <div class="job-detail-row">
                                <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                <span class="job-detail-text">Kitchen sink repair and new tap installation</span>
                            </div>
                            <div class="job-detail-row">
                                <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span class="job-detail-text">SW11</span>
                            </div>
                            <div class="job-detail-row">
                                <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                <span class="job-detail-text">Completed 3 days ago</span>
                            </div>
                        </div>
                        <div class="review-card-footer">
                            <button class="btn btn-primary btn-full leave-review-btn" data-job-id="job-1">
                                <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                </svg>
                                Leave Review
                            </button>
                        </div>
                    </div>

                    <!-- Pending Review Card 2 -->
                    <div class="review-card pending-review-card" data-job-id="job-2">
                        <div class="review-card-header">
                            <div class="vendor-info">
                                <div class="vendor-avatar">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <div class="vendor-details">
                                    <h3 class="vendor-name">Sarah Williams</h3>
                                    <span class="vendor-trade-badge">Electrician</span>
                                </div>
                            </div>
                        </div>
                        <div class="review-card-body">
                            <div class="job-detail-row">
                                <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                <span class="job-detail-text">Full house rewiring for 3-bedroom home</span>
                            </div>
                            <div class="job-detail-row">
                                <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <span class="job-detail-text">N1</span>
                            </div>
                            <div class="job-detail-row">
                                <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                <span class="job-detail-text">Completed 1 week ago</span>
                            </div>
                        </div>
                        <div class="review-card-footer">
                            <button class="btn btn-primary btn-full leave-review-btn" data-job-id="job-2">
                                <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                </svg>
                                Leave Review
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Empty state for pending (hidden by default) -->
                <div class="empty-state" id="pendingEmptyState" style="display: none;">
                    <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    <h3 class="empty-state-title">You're all caught up</h3>
                    <p class="empty-state-text">Thanks for helping the TradeMatch community!</p>
                </div>
            </div>

            <!-- Submitted Reviews Section -->
            <div class="review-section" id="submittedSection">
                <div class="section-header">
                    <h2 class="section-title">Submitted Reviews</h2>
                    <span class="section-count" id="submittedCount">3</span>
                </div>

                <div class="reviews-grid" id="submittedGrid">
                    <!-- Submitted Review Card 1 -->
                    <div class="review-card submitted-review-card">
                        <div class="review-card-header">
                            <div class="vendor-info">
                                <div class="vendor-avatar">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <div class="vendor-details">
                                    <h3 class="vendor-name">John Davies</h3>
                                    <span class="vendor-trade-badge">Carpenter</span>
                                </div>
                            </div>
                            <div class="review-status-badge">
                                <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Published
                            </div>
                        </div>
                        
                        <div class="star-rating-display">
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        
                        <div class="review-card-body">
                            <p class="review-comment">Absolutely brilliant work! John was professional, punctual, and the quality of his carpentry is outstanding. He built custom shelving for our living room and the finish is perfect. Would highly recommend and will definitely use again.</p>
                            
                            <div class="review-meta">
                                <span class="review-date">Submitted 2 weeks ago</span>
                            </div>
                        </div>
                    </div>

                    <!-- Submitted Review Card 2 -->
                    <div class="review-card submitted-review-card">
                        <div class="review-card-header">
                            <div class="vendor-info">
                                <div class="vendor-avatar">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <div class="vendor-details">
                                    <h3 class="vendor-name">Emma Rodriguez</h3>
                                    <span class="vendor-trade-badge">Painter & Decorator</span>
                                </div>
                            </div>
                            <div class="review-status-badge">
                                <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Published
                            </div>
                        </div>
                        
                        <div class="star-rating-display">
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        
                        <div class="review-card-body">
                            <p class="review-comment">Great job painting our hallway and stairs. Emma was very tidy and cleaned up thoroughly each day. The only reason for 4 stars instead of 5 is she ran slightly over the estimated timeline, but the quality made up for it.</p>
                            
                            <div class="review-meta">
                                <span class="review-date">Submitted 1 month ago</span>
                            </div>
                        </div>
                    </div>

                    <!-- Submitted Review Card 3 -->
                    <div class="review-card submitted-review-card">
                        <div class="review-card-header">
                            <div class="vendor-info">
                                <div class="vendor-avatar">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <div class="vendor-details">
                                    <h3 class="vendor-name">Tom Hughes</h3>
                                    <span class="vendor-trade-badge">Gardener</span>
                                </div>
                            </div>
                            <div class="review-status-badge">
                                <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Published
                            </div>
                        </div>
                        
                        <div class="star-rating-display">
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <svg class="star-icon filled" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                        
                        <div class="review-card-body">
                            <p class="review-comment">Tom completely transformed our back garden. His knowledge of plants and design is excellent. He was friendly, reliable, and left everything spotless. Couldn't be happier with the result!</p>
                            
                            <div class="review-meta">
                                <span class="review-date">Submitted 2 months ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty state for submitted (hidden by default) -->
                <div class="empty-state" id="submittedEmptyState" style="display: none;">
                    <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                    </svg>
                    <h3 class="empty-state-title">No reviews yet</h3>
                    <p class="empty-state-text">Once you complete a job, you'll be able to leave a review here.</p>
                </div>
            </div>

            <!-- Verification Footer Note -->
            <div class="verification-note">
                <svg class="verification-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <p class="verification-text">Reviews are verified and linked to completed jobs. They cannot be edited after submission.</p>
            </div>
        </div>
    </main>

<!-- Review Submission Modal -->
    <div class="modal-overlay" id="reviewModal">
        <div class="modal-container review-modal">
            <div class="modal-header">
                <h2 class="modal-title">Leave a Review</h2>
                <button class="modal-close" id="closeReviewModal">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <!-- Vendor info in modal -->
                <div class="review-modal-vendor-info">
                    <div class="vendor-avatar">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <div class="vendor-details">
                        <h3 class="vendor-name" id="modalVendorName">Vendor Name</h3>
                        <span class="vendor-trade-badge" id="modalVendorTrade">Trade</span>
                    </div>
                </div>

                <form id="reviewForm">
                    <!-- Star Rating Selector -->
                    <div class="form-group">
                        <label class="form-label">Rating <span class="required">*</span></label>
                        <div class="star-rating-selector" id="starRatingSelector">
                            <input type="radio" name="rating" id="star5" value="5" required>
                            <label for="star5" class="star-label">
                                <svg class="star-icon" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </label>
                            
                            <input type="radio" name="rating" id="star4" value="4">
                            <label for="star4" class="star-label">
                                <svg class="star-icon" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </label>
                            
                            <input type="radio" name="rating" id="star3" value="3">
                            <label for="star3" class="star-label">
                                <svg class="star-icon" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </label>
                            
                            <input type="radio" name="rating" id="star2" value="2">
                            <label for="star2" class="star-label">
                                <svg class="star-icon" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </label>
                            
                            <input type="radio" name="rating" id="star1" value="1">
                            <label for="star1" class="star-label">
                                <svg class="star-icon" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </label>
                        </div>
                        <p class="form-help" id="ratingHelp"></p>
                    </div>

                    <!-- Review Comment -->
                    <div class="form-group">
                        <label class="form-label" for="reviewComment">Your Review</label>
                        <textarea 
                            id="reviewComment" 
                            class="form-textarea" 
                            placeholder="Describe your experience with this tradesperson"
                            maxlength="500"
                            rows="5"
                        ></textarea>
                        <div class="form-footer">
                            <p class="form-help">Help others by sharing details about quality, professionalism, and value</p>
                            <span class="char-counter"><span id="charCount">0</span>/500</span>
                        </div>
                    </div>

                    <!-- Important Notice -->
                    <div class="review-notice">
                        <svg class="notice-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <p class="notice-text">Your review cannot be edited or deleted once submitted. Please ensure all information is accurate.</p>
                    </div>

                    <!-- Form Actions -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancelReviewBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            Submit Review
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal" style="display: none;">
        <div class="modal-container success-modal">
            <div class="success-icon-wrapper">
                <svg class="success-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
            </div>
            <h2 class="success-title">Review Submitted!</h2>
            <p class="success-text">Thank you for helping the TradeMatch community. Your review has been published.</p>
            <button class="btn btn-primary" id="closeSuccessModal">Done</button>
        </div>
    </div>

    <script src="../dashboardApp.js"></script>
<script>
        /**
         * Reviews Page JavaScript
         * Handles review submission, filtering, and modal interactions
         */

        const reviewFilter = document.getElementById('reviewFilter');
        const pendingSection = document.getElementById('pendingSection');
        const submittedSection = document.getElementById('submittedSection');
        const pendingGrid = document.getElementById('pendingGrid');
        const submittedGrid = document.getElementById('submittedGrid');
        const pendingCountEl = document.getElementById('pendingCount');
        const submittedCountEl = document.getElementById('submittedCount');
        const pendingEmptyState = document.getElementById('pendingEmptyState');
        const submittedEmptyState = document.getElementById('submittedEmptyState');

        const reviewModal = document.getElementById('reviewModal');
        const closeReviewModal = document.getElementById('closeReviewModal');
        const cancelReviewBtn = document.getElementById('cancelReviewBtn');
        const reviewForm = document.getElementById('reviewForm');
        const successModal = document.getElementById('successModal');
        const closeSuccessModal = document.getElementById('closeSuccessModal');
        const reviewComment = document.getElementById('reviewComment');
        const charCount = document.getElementById('charCount');
        const starRatingSelector = document.getElementById('starRatingSelector');
        const ratingHelp = document.getElementById('ratingHelp');

        const DEMO_PENDING_REVIEWS = [
            {
                quoteId: 'job-1',
                vendorId: 'vendor-1',
                vendorName: 'Mike Thompson',
                vendorTrade: 'Plumber',
                jobTitle: 'Kitchen sink repair and new tap installation',
                location: 'SW11',
                completedDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
            },
            {
                quoteId: 'job-2',
                vendorId: 'vendor-2',
                vendorName: 'Sarah Williams',
                vendorTrade: 'Electrician',
                jobTitle: 'Full house rewiring for 3-bedroom home',
                location: 'N1',
                completedDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
            }
        ];

        const DEMO_SUBMITTED_REVIEWS = [
            {
                id: 'rev-1',
                vendor_name: 'John Davies',
                vendor_trade: 'Carpenter',
                rating: 5,
                review_text: 'Absolutely brilliant work! John was professional, punctual, and the quality of his carpentry is outstanding. Would highly recommend.',
                created_at: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
            },
            {
                id: 'rev-2',
                vendor_name: 'Emma Rodriguez',
                vendor_trade: 'Painter & Decorator',
                rating: 4,
                review_text: 'Great job painting our hallway and stairs. Emma was tidy and cleaned up thoroughly each day.',
                created_at: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString()
            }
        ];

        let currentReviewContext = null;
        let pendingReviewsData = [];
        let submittedReviewsData = [];

        reviewFilter.addEventListener('change', (e) => {
            const filterValue = e.target.value;

            pendingSection.style.display = 'none';
            submittedSection.style.display = 'none';

            if (filterValue === 'all') {
                pendingSection.style.display = 'block';
                submittedSection.style.display = 'block';
            } else if (filterValue === 'pending') {
                pendingSection.style.display = 'block';
            } else if (filterValue === 'submitted') {
                submittedSection.style.display = 'block';
            }
        });

        const ratingDescriptions = {
            1: 'Poor - Significant issues',
            2: 'Below Average - Some problems',
            3: 'Average - Met expectations',
            4: 'Good - Better than expected',
            5: 'Excellent - Outstanding service'
        };

        function formatRelativeTime(dateValue, prefix) {
            if (!dateValue) return `${prefix} recently`;
            const date = new Date(dateValue);
            if (Number.isNaN(date.getTime())) return `${prefix} recently`;

            const diffMs = Date.now() - date.getTime();
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            if (diffDays <= 0) return `${prefix} today`;
            if (diffDays === 1) return `${prefix} 1 day ago`;
            if (diffDays < 7) return `${prefix} ${diffDays} days ago`;
            const diffWeeks = Math.floor(diffDays / 7);
            if (diffWeeks < 5) return `${prefix} ${diffWeeks} week${diffWeeks === 1 ? '' : 's'} ago`;
            const diffMonths = Math.floor(diffDays / 30);
            return `${prefix} ${diffMonths} month${diffMonths === 1 ? '' : 's'} ago`;
        }

        function buildStarDisplay(rating) {
            const stars = [];
            const safeRating = Math.max(0, Math.min(5, Number(rating) || 0));
            for (let i = 1; i <= 5; i += 1) {
                const filledClass = i <= safeRating ? 'filled' : '';
                stars.push(`
                    <svg class="star-icon ${filledClass}" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                `);
            }
            return stars.join('');
        }

        function updateRatingDisplay() {
            const selectedRating = document.querySelector('input[name="rating"]:checked');
            if (selectedRating) {
                const ratingValue = selectedRating.value;
                ratingHelp.textContent = ratingDescriptions[ratingValue];
                ratingHelp.style.color = 'var(--accent-primary)';
            } else {
                ratingHelp.textContent = '';
            }
        }

        function updateCharCount() {
            const count = reviewComment.value.length;
            charCount.textContent = count;

            if (count > 450) {
                charCount.style.color = 'var(--status-danger)';
            } else if (count > 400) {
                charCount.style.color = 'var(--status-warning)';
            } else {
                charCount.style.color = 'var(--text-secondary)';
            }
        }

        function openReviewModal(review) {
            currentReviewContext = review;
            document.getElementById('modalVendorName').textContent = review.vendorName || 'Vendor';
            document.getElementById('modalVendorTrade').textContent = review.vendorTrade || 'Trade';
            reviewModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            reviewModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            reviewForm.reset();
            updateRatingDisplay();
            updateCharCount();
            currentReviewContext = null;
        }

        function closeSuccess() {
            successModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function renderPendingReviews(reviews) {
            pendingGrid.innerHTML = '';
            pendingCountEl.textContent = reviews.length;

            if (reviews.length === 0) {
                pendingEmptyState.style.display = 'flex';
                pendingGrid.style.display = 'none';
                return;
            }

            pendingEmptyState.style.display = 'none';
            pendingGrid.style.display = 'grid';

            reviews.forEach((review) => {
                const card = document.createElement('div');
                card.className = 'review-card pending-review-card';
                card.dataset.quoteId = review.quoteId;
                card.dataset.vendorId = review.vendorId;
                card.innerHTML = `
                    <div class="review-card-header">
                        <div class="vendor-info">
                            <div class="vendor-avatar">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                            </div>
                            <div class="vendor-details">
                                <h3 class="vendor-name">${review.vendorName || 'Vendor'}</h3>
                                <span class="vendor-trade-badge">${review.vendorTrade || 'Trade'}</span>
                            </div>
                        </div>
                    </div>
                    <div class="review-card-body">
                        <div class="job-detail-row">
                            <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            <span class="job-detail-text">${review.jobTitle || 'Job completed'}</span>
                        </div>
                        <div class="job-detail-row">
                            <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span class="job-detail-text">${review.location || 'Location not set'}</span>
                        </div>
                        <div class="job-detail-row">
                            <svg class="job-detail-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span class="job-detail-text">${formatRelativeTime(review.completedDate, 'Completed')}</span>
                        </div>
                    </div>
                    <div class="review-card-footer">
                        <button class="btn btn-primary btn-full leave-review-btn" data-quote-id="${review.quoteId}" data-vendor-id="${review.vendorId}">
                            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                            </svg>
                            Leave Review
                        </button>
                    </div>
                `;

                const leaveBtn = card.querySelector('.leave-review-btn');
                if (leaveBtn) {
                    leaveBtn.addEventListener('click', () => openReviewModal(review));
                }

                pendingGrid.appendChild(card);
            });
        }

        function renderSubmittedReviews(reviews) {
            submittedGrid.innerHTML = '';
            submittedCountEl.textContent = reviews.length;

            if (reviews.length === 0) {
                submittedEmptyState.style.display = 'flex';
                submittedGrid.style.display = 'none';
                return;
            }

            submittedEmptyState.style.display = 'none';
            submittedGrid.style.display = 'grid';

            reviews.forEach((review) => {
                const reviewText = review.review_text || review.feedback || 'No review text provided.';
                const ratingValue = review.rating || 0;
                const vendorName = review.vendor_name || review.vendorName || 'Vendor';
                const vendorTrade = review.vendor_trade || review.vendorTrade || review.service_type || 'Trade';
                const createdAt = review.created_at || review.submitted_at || review.date;

                const card = document.createElement('div');
                card.className = 'review-card submitted-review-card';
                card.innerHTML = `
                    <div class="review-card-header">
                        <div class="vendor-info">
                            <div class="vendor-avatar">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                            </div>
                            <div class="vendor-details">
                                <h3 class="vendor-name">${vendorName}</h3>
                                <span class="vendor-trade-badge">${vendorTrade}</span>
                            </div>
                        </div>
                        <div class="review-status-badge">
                            <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                            Published
                        </div>
                    </div>
                    <div class="star-rating-display">
                        ${buildStarDisplay(ratingValue)}
                    </div>
                    <div class="review-card-body">
                        <p class="review-comment">${reviewText}</p>
                        <div class="review-meta">
                            <span class="review-date">${formatRelativeTime(createdAt, 'Submitted')}</span>
                        </div>
                    </div>
                `;

                submittedGrid.appendChild(card);
            });
        }

        async function loadSubmittedReviews() {
            const token = getAuthToken();
            if (!token || isDemoToken(token)) {
                return [...DEMO_SUBMITTED_REVIEWS];
            }

            try {
                const data = await apiFetchJson('/api/customer/reviews');
                return Array.isArray(data?.reviews) ? data.reviews : [];
            } catch (error) {
                console.warn('Failed to load submitted reviews:', error);
                return [];
            }
        }

        async function loadPendingReviews(submittedReviews) {
            const token = getAuthToken();
            if (!token || isDemoToken(token)) {
                return [...DEMO_PENDING_REVIEWS];
            }

            const quotes = await loadCustomerQuotesFromApi();
            if (!Array.isArray(quotes)) return [];

            const submittedQuoteIds = new Set(
                submittedReviews.map((review) => String(review.quote_id || review.quoteId))
            );

            const eligibleStatuses = new Set(['completed', 'closed', 'in_progress']);

            const pendingCandidates = quotes.filter((quote) => {
                const status = String(quote.status || '').toLowerCase();
                if (!eligibleStatuses.has(status)) return false;
                return !submittedQuoteIds.has(String(quote.id));
            });

            const pendingDetails = await Promise.all(pendingCandidates.map(async (quote) => {
                const detail = await loadCustomerQuoteDetailsFromApi(quote.id);
                const quoteData = detail?.quote || quote;
                const bids = detail?.bids || [];

                const acceptedBidId = quoteData?.accepted_bid_id || quote.accepted_bid_id;
                let acceptedBid = null;

                if (acceptedBidId) {
                    acceptedBid = bids.find((bid) => String(bid.id) === String(acceptedBidId)) || null;
                }

                if (!acceptedBid && bids.length) {
                    acceptedBid = bids[0];
                }

                const vendorId = acceptedBid?.vendor_id || quoteData?.vendor_id || null;
                if (!vendorId) return null;

                return {
                    quoteId: quoteData?.id || quote.id,
                    vendorId,
                    vendorName: acceptedBid?.company_name || acceptedBid?.vendor_name || 'Vendor',
                    vendorTrade: acceptedBid?.service_type || quoteData?.service_type || 'Trade',
                    jobTitle: quoteData?.title || quote.title || 'Job completed',
                    location: quoteData?.postcode || quoteData?.location || quote.postcode || quote.location || 'Location not set',
                    completedDate: quoteData?.completed_at || quoteData?.updated_at || quote.updated_at || quoteData?.created_at || quote.created_at
                };
            }));

            return pendingDetails.filter(Boolean);
        }

        async function initReviewsPage() {
            updateCharCount();

            submittedReviewsData = await loadSubmittedReviews();
            pendingReviewsData = await loadPendingReviews(submittedReviewsData);

            renderPendingReviews(pendingReviewsData);
            renderSubmittedReviews(submittedReviewsData);
        }

        starRatingSelector.addEventListener('mouseover', (e) => {
            if (e.target.classList.contains('star-label') || e.target.closest('.star-label')) {
                const label = e.target.closest('.star-label') || e.target;
                const input = document.querySelector(`#${label.getAttribute('for')}`);
                if (input) {
                    const ratingValue = input.value;
                    ratingHelp.textContent = ratingDescriptions[ratingValue];
                    ratingHelp.style.color = 'var(--text-secondary)';
                }
            }
        });

        starRatingSelector.addEventListener('mouseout', () => {
            updateRatingDisplay();
        });

        document.querySelectorAll('input[name="rating"]').forEach((radio) => {
            radio.addEventListener('change', updateRatingDisplay);
        });

        reviewComment.addEventListener('input', updateCharCount);

        closeReviewModal.addEventListener('click', closeModal);
        cancelReviewBtn.addEventListener('click', closeModal);
        closeSuccessModal.addEventListener('click', closeSuccess);

        reviewModal.addEventListener('click', (e) => {
            if (e.target === reviewModal) {
                closeModal();
            }
        });

        successModal.addEventListener('click', (e) => {
            if (e.target === successModal) {
                closeSuccess();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (reviewModal.style.display === 'flex') {
                    closeModal();
                }
                if (successModal.style.display === 'flex') {
                    closeSuccess();
                }
            }
        });

        reviewForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const rating = document.querySelector('input[name="rating"]:checked');
            const comment = reviewComment.value.trim();

            if (!rating) {
                notifyError('Please select a star rating');
                return;
            }

            if (!currentReviewContext?.quoteId || !currentReviewContext?.vendorId) {
                notifyError('Missing review details. Please refresh and try again.');
                return;
            }

            const submitBtn = reviewForm.querySelector('button[type="submit"]');
            const submitBtnHtml = submitBtn ? submitBtn.innerHTML : '';
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
            }

            try {
                const token = typeof getAuthToken === 'function' ? getAuthToken() : localStorage.getItem('token');
                const demoToken = typeof isDemoToken === 'function'
                    ? isDemoToken(token)
                    : token === 'demo-token';

                let didSubmitApi = false;
                if (token && !demoToken && typeof apiFetchJson === 'function') {
                    try {
                        await apiFetchJson('/api/reviews', {
                            method: 'POST',
                            body: JSON.stringify({
                                quote_id: currentReviewContext.quoteId,
                                vendor_id: currentReviewContext.vendorId,
                                rating: Number(rating.value),
                                comment
                            })
                        });
                        submittedReviewsData = await loadSubmittedReviews();
                        pendingReviewsData = await loadPendingReviews(submittedReviewsData);
                        didSubmitApi = true;
                    } catch (apiError) {
                        console.warn('Review submit API failed, falling back to demo update:', apiError);
                    }
                }

                if (!didSubmitApi) {
                    const newReview = {
                        id: `demo-${Date.now()}`,
                        vendor_name: currentReviewContext.vendorName,
                        vendor_trade: currentReviewContext.vendorTrade,
                        rating: Number(rating.value),
                        review_text: comment,
                        created_at: new Date().toISOString(),
                        quote_id: currentReviewContext.quoteId
                    };
                    submittedReviewsData = [newReview, ...submittedReviewsData];
                    pendingReviewsData = pendingReviewsData.filter((item) => item.quoteId !== currentReviewContext.quoteId);
                }

                closeModal();
                renderPendingReviews(pendingReviewsData);
                renderSubmittedReviews(submittedReviewsData);
                successModal.style.display = 'flex';
            } catch (error) {
                if (typeof notifyError === 'function') {
                    notifyError(error?.message || 'Failed to submit review');
                } else {
                    alert(error?.message || 'Failed to submit review');
                }
            } finally {
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = submitBtnHtml || 'Submit Review';
                }
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            initReviewsPage();
        });
    </script>
</body>
</html>

